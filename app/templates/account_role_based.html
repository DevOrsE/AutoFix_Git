{% extends "base.html" %}
{% block title %}–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç{% endblock %}
{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.login }}!</h2>

  {% if role == 'admin' %}
    <h4 class="mb-3">–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h4>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>ID</th>
          <th>–õ–æ–≥–∏–Ω</th>
          <th>–ê–≤—Ç–æ</th>
          <th>–£–¥–∞–ª–∏—Ç—å</th>
        </tr>
      </thead>
      <tbody>
        {% for u in all_users %}
        <tr>
          <td>{{ u.id }}</td>
          <td>{{ u.login }}</td>
          <td>
            {% for car in u.cars %}
              {{ car.model.name }} ‚Äî {{ car.plate_number }}<br>
            {% endfor %}
          </td>
          <td>
            <form method="POST" action="{{ url_for('admin.delete_user', user_id=u.id) }}">
              <button class="btn btn-danger btn-sm">–£–¥–∞–ª–∏—Ç—å</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

  {% elif role == 'manager' %}
    <h4 class="mb-3">–°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤</h4>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>–ê–≤—Ç–æ</th>
          <th>–ù–æ–º–µ—Ä</th>
          <th>–í–ª–∞–¥–µ–ª–µ—Ü</th>
          <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
          <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
          <th>–°—Ç–∞—Ç—É—Å</th>
          <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody>
        {% for order in all_orders %}
        <tr>
          <td>{{ order.car.model.name }}</td>
          <td>{{ order.car.plate_number }}</td>
          <td>{{ order.car.owner.login }}</td>
          <td>{{ order.car.owner.phone or "‚Äî" }}</td>
          <td>{{ order.description }}</td>
          <td>{{ order.status or "–û–∂–∏–¥–∞–µ—Ç" }}</td>
          <td>
            <a href="{{ url_for('orders.edit_order', order_id=order.id) }}" class="btn btn-warning btn-sm">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
            <form method="POST" action="{{ url_for('orders.mark_done', order_id=order.id) }}" style="display:inline;">
              <button class="btn btn-success btn-sm">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</button>
            </form>
            <form method="POST" action="{{ url_for('orders.mark_failed', order_id=order.id) }}" style="display:inline;">
              <button class="btn btn-secondary btn-sm">–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

  {% else %}
    <h4 class="mb-3">–í–∞—à–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏</h4>
    {% if cars %}
      <ul class="list-group mb-4">
        {% for car in cars %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span><strong>{{ car.model.name }}</strong> ‚Äî {{ car.plate_number }} ({{ car.year }})</span>
            <span>
              <a href="{{ url_for('edit_car', car_id=car.id) }}" class="btn btn-sm btn-outline-primary">‚úèÔ∏è</a>
              <form method="POST" action="{{ url_for('delete_car', car_id=car.id) }}" style="display:inline;">
                <button type="submit" class="btn btn-sm btn-outline-danger">üóëÔ∏è</button>
              </form>
            </span>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∞—à–∏–Ω.</p>
    {% endif %}

    <h5 class="mt-4">–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å</h5>
    <form method="POST">
      <div class="mb-3">
        <label class="form-label">–ú–æ–¥–µ–ª—å</label>
        <select name="model_id" class="form-select" required>
          {% for model in models %}
            <option value="{{ model.id }}">{{ model.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="mb-3">
        <label class="form-label">–ù–æ–º–µ—Ä</label>
        <input name="plate" class="form-control" required>
      </div>
      <div class="mb-3">
        <label class="form-label">–ì–æ–¥</label>
        <input name="year" type="number" class="form-control" required>
      </div>
      <div class="mb-3">
        <label class="form-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</label>
        <textarea name="note" class="form-control"></textarea>
      </div>
      <button type="submit" class="btn btn-success">–î–æ–±–∞–≤–∏—Ç—å</button>
    </form>
  {% endif %}
</div>
{% endblock %}